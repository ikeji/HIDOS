a=../cross/doscomm
define run
	$(a) REMOVER.COM $(1).ASM > _$(1).ASM
	$(a) MASM.EXE _$(1),$(1),$(1)\;
	$(RM) _$(1).ASM
endef

bin = BIN/CHKDSK.COM BIN/COMMAND.COM BIN/DEBUG.COM BIN/DISKCOPY.COM \
 BIN/EDLIN.COM BIN/EXE2BIN.EXE BIN/FC.EXE BIN/FIND.EXE BIN/FORMAT.COM \
 BIN/HRDDRV.SYS BIN/MORE.COM BIN/MSDOS.SYS BIN/PROFIL.COM BIN/PRINT.COM \
 BIN/RECOVER.COM BIN/SKELIO.SYS BIN/SORT.EXE BIN/SYS.COM BIN/PC_IO.EXE \
 BIN/PC_BOOT.BIN BIN/VM_IO.SYS BIN/DOS_IO.EXE BIN/98_IO.EXE \
 BIN/98_BOOT.BIN

objs = PC_BOOT.OBJ PC_IO.OBJ VM_IO.OBJ ALLOC.OBJ CHKDSK.OBJ		\
 CHKMES.OBJ CHKPROC.OBJ COMMAND.OBJ COPY.OBJ COPYPROC.OBJ CPARSE.OBJ	\
 DEBASM.OBJ DEBCOM1.OBJ DEBCOM2.OBJ DEBCONST.OBJ DEBDATA.OBJ		\
 DEBMES.OBJ DEBUASM.OBJ DEBUG.OBJ DEV.OBJ DIR.OBJ DIRCALL.OBJ		\
 DISK.OBJ DISKCOPY.OBJ DISKMES.OBJ DOSMES.OBJ EDLIN.OBJ EDLMES.OBJ	\
 EDLPROC.OBJ EXE2BIN.OBJ EXEMES.OBJ FAT.OBJ FC.OBJ FCMES.OBJ FIND.OBJ	\
 FINDMES.OBJ FORMAT.OBJ FORMES.OBJ GENFOR.OBJ GETSET.OBJ HRDDRV.OBJ	\
 INIT.OBJ MISC.OBJ MORE.OBJ MOREMES.OBJ MSCODE.OBJ MSDOS.OBJ		\
 PCLOCK.OBJ PRINT.OBJ PROFIL.OBJ RDATA.OBJ RECMES.OBJ RECOVER.OBJ	\
 ROM.OBJ RUCODE.OBJ SKELIO.OBJ SORT.OBJ SORTMES.OBJ STDBUF.OBJ		\
 STDCALL.OBJ STDCTRLC.OBJ STDFCB.OBJ STDIO.OBJ STDPROC.OBJ SYS.OBJ	\
 SYSIMES.OBJ SYSINIT.OBJ SYSMES.OBJ TCODE.OBJ TCODE2.OBJ TCODE3.OBJ	\
 TCODE4.OBJ TCODE5.OBJ TDATA.OBJ TIME.OBJ TSPC.OBJ TUCODE.OBJ		\
 UINIT.OBJ XENIX.OBJ XENIX2.OBJ DOS_IO.OBJ 98_IO.OBJ 98_BOOT.OBJ

lsts = PC_BOOT.LST PC_IO.LST VM_IO.LST ALLOC.LST CHKDSK.LST		\
 CHKMES.LST CHKPROC.LST COMMAND.LST COPY.LST COPYPROC.LST CPARSE.LST	\
 DEBASM.LST DEBCOM1.LST DEBCOM2.LST DEBCONST.LST DEBDATA.LST		\
 DEBMES.LST DEBUASM.LST DEBUG.LST DEV.LST DIR.LST DIRCALL.LST		\
 DISK.LST DISKCOPY.LST DISKMES.LST DOSMES.LST EDLIN.LST EDLMES.LST	\
 EDLPROC.LST EXE2BIN.LST EXEMES.LST FAT.LST FC.LST FCMES.LST FIND.LST	\
 FINDMES.LST FORMAT.LST FORMES.LST GENFOR.LST GETSET.LST HRDDRV.LST	\
 INIT.LST MISC.LST MORE.LST MOREMES.LST MSCODE.LST MSDOS.LST		\
 PCLOCK.LST PRINT.LST PROFIL.LST RDATA.LST RECMES.LST RECOVER.LST	\
 ROM.LST RUCODE.LST SKELIO.LST SORT.LST SORTMES.LST STDBUF.LST		\
 STDCALL.LST STDCTRLC.LST STDFCB.LST STDIO.LST STDPROC.LST SYS.LST	\
 SYSIMES.LST SYSINIT.LST SYSMES.LST TCODE.LST TCODE2.LST TCODE3.LST	\
 TCODE4.LST TCODE5.LST TDATA.LST TIME.LST TSPC.LST TUCODE.LST		\
 UINIT.LST XENIX.LST XENIX2.LST DOS_IO.LST 98_IO.LST 98_BOOT.LST

help :
	@echo "Usage: cd ../BUILD; make -f ../cross/crossmakefile all"

all : $(bin)

clean :
	$(RM) PMASM.COM SETMAXAL.COM REMOVER.COM RUNREM.COM
	$(RM) PMASM.OBJ SETMAXAL.OBJ REMOVER.OBJ RUNREM.OBJ
	$(RM) $(bin) $(objs) $(lsts)

PMASM.COM : PMASM.ASM
	$(a) MASM.EXE PMASM\;
	$(a) LINK.EXE PMASM\;
	$(a) EXE2BIN.EXE PMASM PMASM.COM
	$(RM) PMASM.EXE
SETMAXAL.COM : SETMAXAL.ASM
	$(a) MASM.EXE SETMAXAL\;
	$(a) LINK.EXE SETMAXAL\;
	$(a) EXE2BIN.EXE SETMAXAL SETMAXAL.COM
	$(RM) SETMAXAL.EXE
REMOVER.COM : PMASM.COM REMOVER.PMA
	$(a) PMASM.COM REMOVER.PMA > REMOVER.ASM
	$(a) MASM.EXE REMOVER\;
	$(a) LINK.EXE REMOVER\;
	$(a) EXE2BIN.EXE REMOVER REMOVER.COM
	$(RM) REMOVER.EXE REMOVER.ASM
RUNREM.COM : PMASM.COM RUNREM.PMA
	$(a) PMASM.COM RUNREM.PMA > RUNREM.ASM
	$(a) MASM.EXE RUNREM\;
	$(a) LINK.EXE RUNREM\;
	$(a) EXE2BIN.EXE RUNREM RUNREM.COM
	$(RM) RUNREM.EXE RUNREM.ASM

# Make additional codes
PC_BOOT.OBJ : REMOVER.COM PC_BOOT.ASM
	$(call run,PC_BOOT)
PC_IO.OBJ : REMOVER.COM PC_IO.ASM
	$(call run,PC_IO)
VM_IO.OBJ : REMOVER.COM VM_IO.ASM
	$(call run,VM_IO)
DOS_IO.OBJ : REMOVER.COM DOS_IO.ASM
	$(call run,DOS_IO)
98_IO.OBJ : REMOVER.COM 98_IO.ASM
	$(call run,98_IO)
98_BOOT.OBJ : REMOVER.COM 98_BOOT.ASM
	$(call run,98_BOOT)
# Make all
ALLOC.OBJ : REMOVER.COM ALLOC.ASM
	$(call run,ALLOC)
CHKDSK.OBJ : REMOVER.COM CHKDSK.ASM
	$(call run,CHKDSK)
CHKMES.OBJ : REMOVER.COM CHKMES.ASM
	$(call run,CHKMES)
CHKPROC.OBJ : REMOVER.COM CHKPROC.ASM
	$(call run,CHKPROC)
COMMAND.OBJ : REMOVER.COM COMMAND.ASM
	$(call run,COMMAND)
COPY.OBJ : REMOVER.COM COPY.ASM
	$(call run,COPY)
COPYPROC.OBJ : REMOVER.COM COPYPROC.ASM
	$(call run,COPYPROC)
CPARSE.OBJ : REMOVER.COM CPARSE.ASM
	$(call run,CPARSE)
DEBASM.OBJ : REMOVER.COM DEBASM.ASM
	$(call run,DEBASM)
DEBCOM1.OBJ : REMOVER.COM DEBCOM1.ASM
	$(call run,DEBCOM1)
DEBCOM2.OBJ : REMOVER.COM DEBCOM2.ASM
	$(call run,DEBCOM2)
DEBCONST.OBJ : REMOVER.COM DEBCONST.ASM
	$(call run,DEBCONST)
DEBDATA.OBJ : REMOVER.COM DEBDATA.ASM
	$(call run,DEBDATA)
DEBMES.OBJ : REMOVER.COM DEBMES.ASM
	$(call run,DEBMES)
DEBUASM.OBJ : REMOVER.COM DEBUASM.ASM
	$(call run,DEBUASM)
DEBUG.OBJ : REMOVER.COM DEBUG.ASM
	$(call run,DEBUG)
DEV.OBJ : REMOVER.COM DEV.ASM
	$(call run,DEV)
DIR.OBJ : REMOVER.COM DIR.ASM
	$(call run,DIR)
DIRCALL.OBJ : REMOVER.COM DIRCALL.ASM
	$(call run,DIRCALL)
DISK.OBJ : REMOVER.COM DISK.ASM
	$(call run,DISK)
DISKCOPY.OBJ : REMOVER.COM DISKCOPY.ASM
	$(call run,DISKCOPY)
DISKMES.OBJ : REMOVER.COM DISKMES.ASM
	$(call run,DISKMES)
DOSMES.OBJ : REMOVER.COM DOSMES.ASM
	$(call run,DOSMES)
EDLIN.OBJ : REMOVER.COM EDLIN.ASM
	$(call run,EDLIN)
EDLMES.OBJ : REMOVER.COM EDLMES.ASM
	$(call run,EDLMES)
EDLPROC.OBJ : REMOVER.COM EDLPROC.ASM
	$(call run,EDLPROC)
EXE2BIN.OBJ : REMOVER.COM EXE2BIN.ASM
	$(call run,EXE2BIN)
EXEMES.OBJ : REMOVER.COM EXEMES.ASM
	$(call run,EXEMES)
FAT.OBJ : REMOVER.COM FAT.ASM
	$(call run,FAT)
FC.OBJ : REMOVER.COM FC.ASM
	$(call run,FC)
FCMES.OBJ : REMOVER.COM FCMES.ASM
	$(call run,FCMES)
FIND.OBJ : REMOVER.COM FIND.ASM
	$(call run,FIND)
FINDMES.OBJ : REMOVER.COM FINDMES.ASM
	$(call run,FINDMES)
FORMAT.OBJ : REMOVER.COM FORMAT.ASM
	$(call run,FORMAT)
FORMES.OBJ : REMOVER.COM FORMES.ASM
	$(call run,FORMES)
GENFOR.OBJ : REMOVER.COM GENFOR.ASM
	$(call run,GENFOR)
GETSET.OBJ : REMOVER.COM GETSET.ASM
	$(call run,GETSET)
HRDDRV.OBJ : REMOVER.COM HRDDRV.ASM
	$(call run,HRDDRV)
INIT.OBJ : REMOVER.COM INIT.ASM
	$(call run,INIT)
MISC.OBJ : REMOVER.COM MISC.ASM
	$(call run,MISC)
MORE.OBJ : REMOVER.COM MORE.ASM
	$(call run,MORE)
MOREMES.OBJ : REMOVER.COM MOREMES.ASM
	$(call run,MOREMES)
MSCODE.OBJ : REMOVER.COM MSCODE.ASM
	$(call run,MSCODE)
MSDOS.OBJ : REMOVER.COM MSDOS.ASM
	$(call run,MSDOS)
PCLOCK.OBJ : REMOVER.COM PCLOCK.ASM
	$(call run,PCLOCK)
PRINT.OBJ : REMOVER.COM PRINT.ASM
	$(call run,PRINT)
PROFIL.OBJ : REMOVER.COM PROFIL.ASM
	$(call run,PROFIL)
RDATA.OBJ : REMOVER.COM RDATA.ASM
	$(call run,RDATA)
RECMES.OBJ : REMOVER.COM RECMES.ASM
	$(call run,RECMES)
RECOVER.OBJ : REMOVER.COM RECOVER.ASM
	$(call run,RECOVER)
ROM.OBJ : REMOVER.COM ROM.ASM
	$(call run,ROM)
RUCODE.OBJ : REMOVER.COM RUCODE.ASM
	$(call run,RUCODE)
SKELIO.OBJ : REMOVER.COM SKELIO.ASM
	$(call run,SKELIO)
SORT.OBJ : REMOVER.COM SORT.ASM
	$(call run,SORT)
SORTMES.OBJ : REMOVER.COM SORTMES.ASM
	$(call run,SORTMES)
STDBUF.OBJ : REMOVER.COM STDBUF.ASM
	$(call run,STDBUF)
STDCALL.OBJ : REMOVER.COM STDCALL.ASM
	$(call run,STDCALL)
STDCTRLC.OBJ : REMOVER.COM STDCTRLC.ASM
	$(call run,STDCTRLC)
STDFCB.OBJ : REMOVER.COM STDFCB.ASM
	$(call run,STDFCB)
STDIO.OBJ : REMOVER.COM STDIO.ASM
	$(call run,STDIO)
STDPROC.OBJ : REMOVER.COM STDPROC.ASM
	$(call run,STDPROC)
SYS.OBJ : REMOVER.COM SYS.ASM
	$(call run,SYS)
SYSIMES.OBJ : REMOVER.COM SYSIMES.ASM
	$(call run,SYSIMES)
SYSINIT.OBJ : REMOVER.COM SYSINIT.ASM
	$(call run,SYSINIT)
SYSMES.OBJ : REMOVER.COM SYSMES.ASM
	$(call run,SYSMES)
TCODE.OBJ : REMOVER.COM TCODE.ASM
	$(call run,TCODE)
TCODE2.OBJ : REMOVER.COM TCODE2.ASM
	$(call run,TCODE2)
TCODE3.OBJ : REMOVER.COM TCODE3.ASM
	$(call run,TCODE3)
TCODE4.OBJ : REMOVER.COM TCODE4.ASM
	$(call run,TCODE4)
TCODE5.OBJ : REMOVER.COM TCODE5.ASM
	$(call run,TCODE5)
TDATA.OBJ : REMOVER.COM TDATA.ASM
	$(call run,TDATA)
TIME.OBJ : REMOVER.COM TIME.ASM
	$(call run,TIME)
TSPC.OBJ : REMOVER.COM TSPC.ASM
	$(call run,TSPC)
TUCODE.OBJ : REMOVER.COM TUCODE.ASM
	$(call run,TUCODE)
UINIT.OBJ : REMOVER.COM UINIT.ASM
	$(call run,UINIT)
XENIX.OBJ : REMOVER.COM XENIX.ASM
	$(call run,XENIX)
XENIX2.OBJ : REMOVER.COM XENIX2.ASM
	$(call run,XENIX2)


BIN/CHKDSK.COM : CHKDSK.OBJ CHKPROC.OBJ CHKMES.OBJ
	$(a) LINK.EXE CHKDSK+CHKPROC+CHKMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE CHKDSK BIN/CHKDSK.COM
	$(RM) CHKDSK.EXE
BIN/COMMAND.COM : COMMAND.OBJ RUCODE.OBJ RDATA.OBJ INIT.OBJ UINIT.OBJ TCODE.OBJ TCODE2.OBJ TCODE3.OBJ \
 TCODE4.OBJ TCODE5.OBJ TUCODE.OBJ COPY.OBJ COPYPROC.OBJ CPARSE.OBJ TDATA.OBJ TSPC.OBJ
	$(a) LINK.EXE @COMLINK
	mkdir -p BIN
	$(a) EXE2BIN.EXE COMMAND BIN/COMMAND.COM
	$(RM) COMMAND.EXE
BIN/DEBUG.COM : DEBUG.OBJ DEBCOM1.OBJ DEBCOM2.OBJ DEBASM.OBJ DEBUASM.OBJ DEBCONST.OBJ DEBMES.OBJ DEBDATA.OBJ
	$(a) LINK.EXE \
	 DEBUG+DEBCOM1+DEBCOM2+DEBASM+DEBUASM+DEBCONST+DEBMES+DEBDATA\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE DEBUG BIN/DEBUG.COM
	$(RM) DEBUG.EXE
BIN/DISKCOPY.COM : DISKCOPY.OBJ DISKMES.OBJ
	$(a) LINK.EXE DISKCOPY+DISKMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE DISKCOPY BIN/DISKCOPY.COM
	$(RM) DISKCOPY.EXE
BIN/EDLIN.COM : EDLIN.OBJ EDLPROC.OBJ EDLMES.OBJ
	$(a) LINK.EXE EDLIN+EDLPROC+EDLMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE EDLIN BIN/EDLIN.COM
	$(RM) EDLIN.EXE
BIN/EXE2BIN.EXE : EXE2BIN.OBJ EXEMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE EXE2BIN+EXEMES,BIN/EXE2BIN\;
BIN/FC.EXE : FC.OBJ FCMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE FC+FCMES,BIN/FC\;
BIN/FIND.EXE : FIND.OBJ FINDMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE FIND+FINDMES,BIN/FIND\;
BIN/FORMAT.COM : FORMAT.OBJ FORMES.OBJ GENFOR.OBJ
	$(a) LINK.EXE FORMAT+FORMES+GENFOR\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE FORMAT BIN/FORMAT.COM
	$(RM) FORMAT.EXE
BIN/HRDDRV.SYS : HRDDRV.OBJ
	$(a) LINK.EXE HRDDRV\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE HRDDRV BIN/HRDDRV.SYS
	$(RM) HRDDRV.EXE
BIN/MORE.COM : MORE.OBJ MOREMES.OBJ
	$(a) LINK.EXE MORE+MOREMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE MORE BIN/MORE.COM
	$(RM) MORE.EXE
BIN/MSDOS.SYS : MSDOS.OBJ MSCODE.OBJ DOSMES.OBJ MISC.OBJ GETSET.OBJ DIRCALL.OBJ ALLOC.OBJ DEV.OBJ DIR.OBJ \
 DISK.OBJ FAT.OBJ ROM.OBJ STDBUF.OBJ STDCALL.OBJ STDCTRLC.OBJ STDFCB.OBJ STDPROC.OBJ \
 STDIO.OBJ TIME.OBJ XENIX.OBJ XENIX2.OBJ
	$(a) LINK.EXE @DOSLINK
	mkdir -p BIN
	$(a) EXE2BIN.EXE MSDOS BIN/MSDOS.SYS
	$(RM) MSDOS.EXE
BIN/PROFIL.COM : PROFIL.OBJ PCLOCK.OBJ
	$(a) LINK.EXE PROFIL+PCLOCK\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE PROFIL BIN/PROFIL.COM
	$(RM) PROFIL.EXE
BIN/PRINT.COM : PRINT.OBJ
	$(a) LINK.EXE PRINT\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE PRINT BIN/PRINT.COM
	$(RM) PRINT.EXE
BIN/RECOVER.COM : RECOVER.OBJ RECMES.OBJ
	$(a) LINK.EXE RECOVER+RECMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE RECOVER BIN/RECOVER.COM
	$(RM) RECOVER.EXE
BIN/SKELIO.SYS : SKELIO.OBJ SYSINIT.OBJ SYSIMES.OBJ
	$(a) LINK.EXE SKELIO+SYSINIT+SYSIMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE SKELIO BIN/SKELIO.SYS < SKELIO.ADR
	$(RM) SKELIO.EXE
BIN/SORT.EXE : SETMAXAL.COM SORT.OBJ SORTMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE SORT+SORTMES,BIN/SORT\;
	$(a) SETMAXAL.COM BIN/SORT.EXE 1
BIN/SYS.COM : SYS.OBJ SYSMES.OBJ
	$(a) LINK.EXE SYS+SYSMES\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE SYS BIN/SYS.COM
	$(RM) SYS.EXE

BIN/PC_IO.EXE : PC_IO.OBJ SYSINIT.OBJ SYSIMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE PC_IO+SYSINIT+SYSIMES,BIN/PC_IO\;
BIN/PC_BOOT.BIN : PC_BOOT.OBJ
	$(a) LINK.EXE PC_BOOT\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE PC_BOOT BIN/PC_BOOT.BIN
	$(RM) PC_BOOT.EXE
BIN/VM_IO.SYS : VM_IO.OBJ SYSINIT.OBJ SYSIMES.OBJ
	$(a) LINK.EXE VM_IO+SYSINIT+SYSIMES,VM_IO\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE VM_IO BIN/VM_IO.SYS < VM_IO.ADR
	$(RM) VM_IO.EXE
BIN/DOS_IO.EXE : DOS_IO.OBJ SYSINIT.OBJ SYSIMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE DOS_IO+SYSINIT+SYSIMES,BIN/DOS_IO\;
BIN/98_IO.EXE : 98_IO.OBJ SYSINIT.OBJ SYSIMES.OBJ
	mkdir -p BIN
	$(a) LINK.EXE 98_IO+SYSINIT+SYSIMES,BIN/98_IO\;
BIN/98_BOOT.BIN : 98_BOOT.OBJ
	$(a) LINK.EXE 98_BOOT\;
	mkdir -p BIN
	$(a) EXE2BIN.EXE 98_BOOT BIN/98_BOOT.BIN
	$(RM) 98_BOOT.EXE
